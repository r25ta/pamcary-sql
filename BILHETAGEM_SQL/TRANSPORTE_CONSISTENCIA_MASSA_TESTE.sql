SELECT * FROM SEguro.TSEG_PROPOSTA_LIMITE tpl 
WHERE NUM_PROPT = 23002190

SELECT * FROM CRP_PESSOA 
WHERE CTL_PESSO = 15425


SELECT ai.CTL_AVERB, ai.NUM_PROPT, a.VLR_EMBAR, a.COD_MANIF, ai.CTL_PESSO, ai.CTL_VINCD_SED, A.DHR_AVERB FROM AVERBACAO_INDICE ai
INNER JOIN AVERBACAO a ON a.CTL_AVERB = ai.CTL_AVERB 
WHERE ai.CTL_PESSO = 15425

SELECT * FROM SEGURO.TSEG_PROPOSTA_SEGURO s 
INNER JOIN seguro.TSEG_PROPOSTA_LIMITE pl 
ON (pl.NUM_PROPT, pl.NUM_VERSA_PRS) = (s.NUM_PROPT,pl.NUM_VERSA_PRS)
WHERE s.NUM_VERSA_PRS 
AND s.TIP_PROPT = 1
AND s.NUM_PROPT IN (22002169, 23002190)

SELECT * FROM AVERBACAO 
WHERE CTL_AVERB IN (
571720601,
571720602,
571720603,
571720604,
571720605,
571720606,
571720607,
571720608,
571720609,
571720610,
571720611,
571720612,
571720613,
571720614,
571720615
)

--Manipular massa de dados
UPDATE AVERBACAO SET 
DAT_EMBAR = CURRENT date 
,HOR_EMBAR ='10:00'
,DHR_AVERB = CURRENT TIMESTAMP
,DHR_ENTRA = CURRENT TIMESTAMP
,DHR_LIBER = CURRENT TIMESTAMP
,DHR_ALTER = CURRENT timestamp 
WHERE CTL_AVERB IN (
571720601,
571720602,
571720603,
571720604,
571720605,
571720606,
571720607,
571720608,
571720609,
571720610,
571720611,
571720612,
571720613,
571720614,
571720615
)


--limpar averbacao erro
DELETE FROM AVERBACAO_ERRO 
WHERE CTL_AVERB IN (571720601,
571720602,
571720603,
571720604,
571720605,
571720606,
571720607,
571720608,
571720609,
571720610,
571720611,
571720612,
571720613,
571720614,
571720615
)

--Manipular massa de dados
UPDATE AVERBACAO_INDICE SET 
NUM_PROPT = NULL 
,SIT_AVERB = 0
WHERE CTL_AVERB IN (
571720601,
571720602,
571720603,
571720604,
571720605,
571720606,
571720607,
571720608,
571720609,
571720610,
571720611,
571720612,
571720613,
571720614,
571720615
)

--INSERT MASSA DE DADOS
INSERT INTO AVERBACAO_CONSISTENCIA (CTL_AVERB, CTL_USER, DHR_ALTER, SIT_AVERB, NUM_SEQ)
SELECT CTL_AVERB, 15, CURRENT timestamp, 0, 0  
from AVERBACAO
WHERE CTL_AVERB IN (571720601,
571720602,
571720603,
571720604,
571720605,
571720606,
571720607,
571720608,
571720609,
571720610,
571720611,
571720612,
571720613,
571720614,
571720615
)

COMMIT


--PROPT 23002190
--VIGENCIA 2023-04-30	2025-04-30

--propt 22002169
--vigencia apolice 2022-04-30	2023-04-30
--12	APOLICE VIGENTE NAO ENCONTRADA
--91	VALOR DE EMBARQUE SUPERIOR AO LIMITE
--97	AVERBACAO TESTE
--120	LIMITE NAO ENCONTRADO

SELECT a.CTL_AVERB, ai.NUM_PROPT, a.COD_MANIF, a.VLR_EMBAR, a.DHR_AVERB, ae.TIP_ERRO, ae.STA_CONSIST, ae.DHR_ALTER, ae.COD_USER 
FROM AVERBACAO a 
LEFT JOIN AVERBACAO_ERRO ae ON ae.CTL_AVERB = a.CTL_AVERB
INNER JOIN AVERBACAO_INDICE ai ON ai.CTL_AVERB = a.CTL_AVERB 
WHERE a.CTL_AVERB IN 
(SELECT CTL_AVERB  FROM APLTRANS.AVERBACAO_ERRO 
)


SELECT ea.tip_erro, ea.DES_ERRO, count(1) 
FROM APLTRANS.AVERBACAO_ERRO ae INNER JOIN APLTRANS.ERRO_AVERBACAO ea 
ON ea.TIP_ERRO = ae.TIP_ERRO 
GROUP BY ea.tip_erro, ea.DES_ERRO


SELECT * FROM ERRO_AVERBACAO 

SELECT ai.CTL_AVERB AS ctlAverb, * 
FROM AVERBACAO_CONSISTENCIA ac
JOIN AVERBACAO_INDICE AI
ON ac.CTL_AVERB = ai.CTL_AVERB
WHERE ac.SIT_AVERB = 0
AND ai.CTL_PESSO NOT IN (SELECT se.ctl_pesso
FROM SEGURADO_EXCLUIDO_CONSISTENCIA se WHERE se.STA_INATIVO = 0)
AND (ai.CTL_PESSO, ai.NUM_RAMO) in ( SELECT sp.CTL_PESSO, sp.NUM_RAMO_SEG FROM SEGURADO_PARALELO sp )
AND ai.CTL_AVERB IN (
571720601,
571720602,
571720603,
571720604,
571720605,
571720606,
571720607,
571720608,
571720609,
571720610,
571720611,
571720612,
571720613,
571720614,
571720615)
ORDER BY ac.DHR_ALTER ASC LIMIT 1000

select n_dead_tup, relname, schemaname from pg_stat_user_tables order by 1 asc 



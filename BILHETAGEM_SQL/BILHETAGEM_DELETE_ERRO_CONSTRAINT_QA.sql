/*VERIFICA CONTAS EM PROCESSAMENTO*/
select 
      c.num_apoli,
      b.seq_numer_prs,
      a.dhr_inici_prt,
      a.dhr_fim_prt,
      a.dhr_alter,
      a.cod_auten_usu,
      a.ctl_contr_taf,
      a.num_taref_val,
      c.*
from gedad.tdad_contr_tarefa_validacao a
, gedad.v_dad_consulta_procs_propt_bilhe b
, bilhet.tbil_proposta c
where a.dhr_fim_prt is null
and b.ctl_contr_taf = a.ctl_contr_taf
and c.seq_numer_prs = b.seq_numer_prs
order by a.dhr_inici_prt



/*LIMPAR FILA DE PROCESSAMENTO*/
DELETE FROM GEDAD.TDAD_CONTR_TAREFA_VALIDACAO
WHERE DHR_FIM_PRT IS NULL
AND CTL_CONTR_TAF IN (
25891237
)

COMMIT 


/*VERIFICAR SE EXISTE NUM_SEQUE_PRS NA TABELA ERROS DE PROCESSAMENTO*/
SELECT DISTINCT seq_numer_prs FROM gedad.tdad_procs_propt_bilhe
WHERE CTL_CONTR_TAF in (
25891237

)  -- ESSE C�DIGO VEM DO LOG DA APLICA��O CAMPO V_OUT_RESULT 
ORDER BY SEQ_NUMER_prs  ASC  


SELECT * FROM bilhet.LOG_BILHET lb 
WHERE 	

/* PROCESSO DE EXCLUS�O DE PROPOSTA PERDIDAS NAS TABELAS DE PROCESSAMENTO*/

/*DELETE 1*/
	DELETE
FROM
	bilhet.TBIL_RELAC_VISAO_PERCU_PADRA
WHERE
	(SEQ_NUMER_PRS,
	SEQ_NUMER_AVB) IN (
	SELECT
		trap.SEQ_NUMER_PRS,
		ta.SEQ_NUMER_AVB
	FROM
		bilhet.TBIL_AVERBACAO ta
	INNER JOIN bilhet.TBIL_RELAC_AVERB_PROPT trap ON
		trap.SEQ_NUMER_AVB = ta.SEQ_NUMER_AVB
	INNER JOIN bilhet.TBIL_PROPOSTA tp ON
		tp.SEQ_NUMER_PRS = trap.SEQ_NUMER_PRS
	WHERE
		tp.SEQ_NUMER_PRS IN 
(509047
,509128
,509143
,508894
,509098
,508896
,508868
,508963
,508970
,508971
,509028
,508939
,508903
,508816
,508792
,508730
,508733
,508741
,508751
,508754
,508772
,508778
,508515
,508593
,508697
,508452
,508637
,508518
,508472
,508429
,508222
,508363
,508371
,508380
,508234
,508158
,508287
,508297
,508299
,508301
,508303
,508305
,508307
,508309
,508197
,508115
,508007
,508009
,508021
,507737
,508136
,507943
,507961
,507967
,507633
,507774
,507775
,507528
,507694
,507700
,507703
,507583
,507345
,507430
,507445
,507253
,507254
,507454
,507166
,507316
,507280
,507282
,507286
,507094
,507025
,507126
,507147
,507155
,506895
,506908
,506802
,506958
,507017
,506916
,506929
,506754
,506826
,506830
,506831
,506770
,506543
,506671
,506681
,506682
,506629
,506468
,506731
,506734
,506445
,506360
,506496
,506369
,506456
,506333
,506194
,506203
,506374
,506386
,506390
,506394
,506207
,506151
,506247
,506253
,506255
,506271
,506273
,506280
,506281
,505958
,506011
,505966
,505917
,505918
,505920
,505875
,505883
,505885
,505887
,505656
,505822
,505825
,505288
,505722
,505724
,505230
,505156
,505637
,505213
,505276
,504904
,504280
,504266
,504207
,504328
,504241
,504194
,504059)
		
AND trap.NUM_ETAPA_AVB = 1
AND trap.SEQ_NUMER_FAT + 0 IS NULL);

commit

/*DELETE 2*/
--
delete FROM bilhet.TBIL_RELAC_VISAO_PERCU_PROPT	
WHERE
(SEQ_NUMER_PRS,
SEQ_NUMER_AVB) IN (
SELECT
	trap.SEQ_NUMER_PRS,
	ta.SEQ_NUMER_AVB
FROM
	bilhet.TBIL_AVERBACAO ta
INNER JOIN bilhet.TBIL_RELAC_AVERB_PROPT trap ON
	trap.SEQ_NUMER_AVB = ta.SEQ_NUMER_AVB
INNER JOIN bilhet.TBIL_PROPOSTA tp ON
	tp.SEQ_NUMER_PRS = trap.SEQ_NUMER_PRS
WHERE
		tp.SEQ_NUMER_PRS IN 
(509047
,509128
,509143
,508894
,509098
,508896
,508868
,508963
,508970
,508971
,509028
,508939
,508903
,508816
,508792
,508730
,508733
,508741
,508751
,508754
,508772
,508778
,508515
,508593
,508697
,508452
,508637
,508518
,508472
,508429
,508222
,508363
,508371
,508380
,508234
,508158
,508287
,508297
,508299
,508301
,508303
,508305
,508307
,508309
,508197
,508115
,508007
,508009
,508021
,507737
,508136
,507943
,507961
,507967
,507633
,507774
,507775
,507528
,507694
,507700
,507703
,507583
,507345
,507430
,507445
,507253
,507254
,507454
,507166
,507316
,507280
,507282
,507286
,507094
,507025
,507126
,507147
,507155
,506895
,506908
,506802
,506958
,507017
,506916
,506929
,506754
,506826
,506830
,506831
,506770
,506543
,506671
,506681
,506682
,506629
,506468
,506731
,506734
,506445
,506360
,506496
,506369
,506456
,506333
,506194
,506203
,506374
,506386
,506390
,506394
,506207
,506151
,506247
,506253
,506255
,506271
,506273
,506280
,506281
,505958
,506011
,505966
,505917
,505918
,505920
,505875
,505883
,505885
,505887
,505656
,505822
,505825
,505288
,505722
,505724
,505230
,505156
,505637
,505213
,505276
,504904
,504280
,504266
,504207
,504328
,504241
,504194
,504059)

	AND trap.NUM_ETAPA_AVB = 1
	AND trap.SEQ_NUMER_FAT + 0 IS NULL);
--


/*DELETE 3*/
DELETE
FROM
	BILHET.TBIL_RELAC_VISAO_PROPT
WHERE
	(SEQ_NUMER_PRS,
	SEQ_NUMER_AVB) IN (
	SELECT
		trap.SEQ_NUMER_PRS,
		ta.SEQ_NUMER_AVB
	FROM
		bilhet.TBIL_AVERBACAO ta
	INNER JOIN bilhet.TBIL_RELAC_AVERB_PROPT trap ON
		trap.SEQ_NUMER_AVB = ta.SEQ_NUMER_AVB
	INNER JOIN bilhet.TBIL_PROPOSTA tp ON
		tp.SEQ_NUMER_PRS = trap.SEQ_NUMER_PRS
	WHERE
		tp.SEQ_NUMER_PRS IN 
(509047
,509128
,509143
,508894
,509098
,508896
,508868
,508963
,508970
,508971
,509028
,508939
,508903
,508816
,508792
,508730
,508733
,508741
,508751
,508754
,508772
,508778
,508515
,508593
,508697
,508452
,508637
,508518
,508472
,508429
,508222
,508363
,508371
,508380
,508234
,508158
,508287
,508297
,508299
,508301
,508303
,508305
,508307
,508309
,508197
,508115
,508007
,508009
,508021
,507737
,508136
,507943
,507961
,507967
,507633
,507774
,507775
,507528
,507694
,507700
,507703
,507583
,507345
,507430
,507445
,507253
,507254
,507454
,507166
,507316
,507280
,507282
,507286
,507094
,507025
,507126
,507147
,507155
,506895
,506908
,506802
,506958
,507017
,506916
,506929
,506754
,506826
,506830
,506831
,506770
,506543
,506671
,506681
,506682
,506629
,506468
,506731
,506734
,506445
,506360
,506496
,506369
,506456
,506333
,506194
,506203
,506374
,506386
,506390
,506394
,506207
,506151
,506247
,506253
,506255
,506271
,506273
,506280
,506281
,505958
,506011
,505966
,505917
,505918
,505920
,505875
,505883
,505885
,505887
,505656
,505822
,505825
,505288
,505722
,505724
,505230
,505156
,505637
,505213
,505276
,504904
,504280
,504266
,504207
,504328
,504241
,504194
,504059)

AND trap.NUM_ETAPA_AVB = 1
AND trap.SEQ_NUMER_FAT + 0 IS NULL);

COMMIT

/*CONSULTA DEBITO CREDITO*/
SELECT * FROM  bilhet.tbil_vigencia_proposta_credb
    WHERE SEQ_CREDB_PRS IN (
    SELECT b.SEQ_CREDB_PRS FROM bilhet.tbil_proposta_credito_debito a INNER JOIN bilhet.tbil_vigencia_proposta_credb B
    ON b.SEQ_CREDB_PRS = a.SEQ_CREDB_PRS 
    WHERE a.SEQ_NUMER_PRS IN(
    
    )
	AND b.DAT_INICI_VIG >= '2024-08-01'
	AND b.DAT_FIM_VIG <= '2024-08-31'
    )

COMMIT

    
 /*VOLTA DEBITO E CREDITO*/
    UPDATE bilhet.tbil_vigencia_proposta_credb SET 
    SEQ_NUMER_fat = NULL 
    WHERE SEQ_CREDB_PRS IN (
    SELECT b.SEQ_CREDB_PRS FROM bilhet.tbil_proposta_credito_debito a INNER JOIN bilhet.tbil_vigencia_proposta_credb B
    ON b.SEQ_CREDB_PRS = a.SEQ_CREDB_PRS 
    WHERE a.SEQ_NUMER_PRS IN
(509047
,509128
,509143
,508894
,509098
,508896
,508868
,508963
,508970
,508971
,509028
,508939
,508903
,508816
,508792
,508730
,508733
,508741
,508751
,508754
,508772
,508778
,508515
,508593
,508697
,508452
,508637
,508518
,508472
,508429
,508222
,508363
,508371
,508380
,508234
,508158
,508287
,508297
,508299
,508301
,508303
,508305
,508307
,508309
,508197
,508115
,508007
,508009
,508021
,507737
,508136
,507943
,507961
,507967
,507633
,507774
,507775
,507528
,507694
,507700
,507703
,507583
,507345
,507430
,507445
,507253
,507254
,507454
,507166
,507316
,507280
,507282
,507286
,507094
,507025
,507126
,507147
,507155
,506895
,506908
,506802
,506958
,507017
,506916
,506929
,506754
,506826
,506830
,506831
,506770
,506543
,506671
,506681
,506682
,506629
,506468
,506731
,506734
,506445
,506360
,506496
,506369
,506456
,506333
,506194
,506203
,506374
,506386
,506390
,506394
,506207
,506151
,506247
,506253
,506255
,506271
,506273
,506280
,506281
,505958
,506011
,505966
,505917
,505918
,505920
,505875
,505883
,505885
,505887
,505656
,505822
,505825
,505288
,505722
,505724
,505230
,505156
,505637
,505213
,505276
,504904
,504280
,504266
,504207
,504328
,504241
,504194
,504059)

	AND b.DAT_INICI_VIG >= '2024-02-01'
	AND b.DAT_FIM_VIG <= '2024-02-29'
    )

commit

/*CANCELA FATURA*/	
SELECT * FROM BILHET.TBIL_FATURA tf 
WHERE SEQ_NUMER_PRS IN (506376)
)
AND NUM_MES_CPT = 202402
ORDER BY DHR_FATUR DESC  


UPDATE BILHET.TBIL_FATURA SET
SIT_FATUR = 6
,IDT_ENVIO_CBR = 'C'
,NUM_MOTIV_SIT = 6
WHERE SEQ_NUMER_PRS IN 
(509047
,509128
,509143
,508894
,509098
,508896
,508868
,508963
,508970
,508971
,509028
,508939
,508903
,508816
,508792
,508730
,508733
,508741
,508751
,508754
,508772
,508778
,508515
,508593
,508697
,508452
,508637
,508518
,508472
,508429
,508222
,508363
,508371
,508380
,508234
,508158
,508287
,508297
,508299
,508301
,508303
,508305
,508307
,508309
,508197
,508115
,508007
,508009
,508021
,507737
,508136
,507943
,507961
,507967
,507633
,507774
,507775
,507528
,507694
,507700
,507703
,507583
,507345
,507430
,507445
,507253
,507254
,507454
,507166
,507316
,507280
,507282
,507286
,507094
,507025
,507126
,507147
,507155
,506895
,506908
,506802
,506958
,507017
,506916
,506929
,506754
,506826
,506830
,506831
,506770
,506543
,506671
,506681
,506682
,506629
,506468
,506731
,506734
,506445
,506360
,506496
,506369
,506456
,506333
,506194
,506203
,506374
,506386
,506390
,506394
,506207
,506151
,506247
,506253
,506255
,506271
,506273
,506280
,506281
,505958
,506011
,505966
,505917
,505918
,505920
,505875
,505883
,505885
,505887
,505656
,505822
,505825
,505288
,505722
,505724
,505230
,505156
,505637
,505213
,505276
,504904
,504280
,504266
,504207
,504328
,504241
,504194
,504059)

AND NUM_MES_CPT = 202402


SELECT * FROM bilhet.TBIL_PROPOSTA tp 






commit




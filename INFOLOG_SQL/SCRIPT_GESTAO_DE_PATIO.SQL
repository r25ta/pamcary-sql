SELECT *  FROM ( SELECT A.*, ROWNUM RNUM FROM (
SELECT  PLANO_CONTROLE.CTL_PLANO_CTL,  PLANO_CONTROLE.CTL_CARRE,  CART.NUM_PLACA CART_PLATE,
PLANO_CONTROLE.CTL_VEICU,  VEHICLE.NUM_PLACA VEHICLE_PLATE,  PLANO_CONTROLE.CTL_TRNSP,
TRANSPORTER.NOM_GUERR TRANSPORTER_NAME,  PLANO_CONTROLE.CTL_VINCD,  UNIT_OP.NOM_GUERR,
PLANO_CONTROLE.DES_UTMO_POS,  TIP.SIG_PARAD,
TO_CHAR(PLANO_CONTROLE.DHR_UTMO_POS, 'YYYY-MM-DD HH24:MI:SS') AS DHR_UTMO_POS,
SITUACAO1.SIT_PLANO_CTL STATUS1,  SITUACAO2.SIT_PLANO_CTL STATUS2,  SITUACAO3.SIT_PLANO_CTL STATUS3,  PCE.DES_PONTO_INS 

/*CAMPO EVENTO INDEVIDO*/
, NVL(EIPC.CTL_PLANO_CTL,0) AS INDEVIDO

FROM PLANO_CONTROLE

LEFT JOIN VEICULO VEHICLE ON VEHICLE.CTL_VEICU = PLANO_CONTROLE.CTL_VEICU
LEFT JOIN VEICULO CART ON CART.CTL_VEICU = PLANO_CONTROLE.CTL_CARRE
LEFT JOIN VINCULADO UNIT_OP ON PLANO_CONTROLE.CTL_VINCD = UNIT_OP.CTL_VINCD
LEFT JOIN VINCULADO TRANSPORTER ON PLANO_CONTROLE.CTL_TRNSP = TRANSPORTER.CTL_VINCD

LEFT JOIN RELAC_PLANO_CONTROLE_SITUA STATUS1 ON STATUS1.CTL_PLANO_CTL = PLANO_CONTROLE.CTL_PLANO_CTL
AND STATUS1.TIP_SITUA = 1

LEFT JOIN RELAC_PLANO_CONTROLE_SITUA STATUS2 ON STATUS2.CTL_PLANO_CTL = PLANO_CONTROLE.CTL_PLANO_CTL
AND STATUS2.TIP_SITUA = 2

LEFT JOIN RELAC_PLANO_CONTROLE_SITUA STATUS3 ON STATUS3.CTL_PLANO_CTL = PLANO_CONTROLE.CTL_PLANO_CTL
AND STATUS3.TIP_SITUA = 3

LEFT JOIN SITUACAO_PLANO_CONTROLE SITUACAO1 ON SITUACAO1.SIT_PLANO_CTL = STATUS1.SIT_PLANO_CTL
AND SITUACAO1.TIP_SITUA = STATUS1.TIP_SITUA

LEFT JOIN SITUACAO_PLANO_CONTROLE SITUACAO2 ON SITUACAO2.SIT_PLANO_CTL = STATUS2.SIT_PLANO_CTL
AND SITUACAO2.TIP_SITUA = STATUS2.TIP_SITUA

LEFT JOIN SITUACAO_PLANO_CONTROLE SITUACAO3 ON SITUACAO3.SIT_PLANO_CTL = STATUS3.SIT_PLANO_CTL
AND SITUACAO3.TIP_SITUA = STATUS3.TIP_SITUA

LEFT JOIN TIPO_PARADA TIP ON PLANO_CONTROLE.CTL_UTMO_PDA = TIP.CTL_PARAD

LEFT JOIN (
 SELECT * FROM EVENTO_PLANO_CONTROLE EPC_AUX
 WHERE EPC_AUX.NUM_EVENT_PLN = (SELECT MAX(GET_MAX_EVENT.NUM_EVENT_PLN)
                                FROM EVENTO_PLANO_CONTROLE GET_MAX_EVENT
                                WHERE GET_MAX_EVENT.CTL_PLANO_CTL = EPC_AUX.CTL_PLANO_CTL                                
                                    AND (GET_MAX_EVENT.CTL_PARAD = 20 OR GET_MAX_EVENT.CTL_PARAD = 26)) ) EPC                                    
ON EPC.CTL_PLANO_CTL = PLANO_CONTROLE.CTL_PLANO_CTL

LEFT JOIN PONTO_CONTR_ETAPA PCE ON PCE.CTL_CONTR_EPA = EPC.CTL_CONTR_EPA

/*RELACIONAMENTO EVENTO INDEVIDO*/
LEFT JOIN (
 SELECT DISTINCT(CTL_PLANO_CTL) FROM EVENTO_INDEVIDO_PLANO_CONTR EIPC_AUX
 WHERE EIPC_AUX.CTL_EVEIN_PLC = ( SELECT MAX(GET_MAX_EVENT_IND.CTL_EVEIN_PLC)
                                FROM EVENTO_INDEVIDO_PLANO_CONTR GET_MAX_EVENT_IND
                                WHERE GET_MAX_EVENT_IND.CTL_EVEIN_PLC = EIPC_AUX.CTL_EVEIN_PLC ) )  EIPC
ON EIPC.CTL_PLANO_CTL = PLANO_CONTROLE.CTL_PLANO_CTL


WHERE PLANO_CONTROLE.CTL_OPERA_TIP = 237
AND PLANO_CONTROLE.CTL_PLANO_CTL = 17422
ORDER BY CTL_PLANO_CTL DESC) A

WHERE ROWNUM <= 100 ) WHERE RNUM >= 1 

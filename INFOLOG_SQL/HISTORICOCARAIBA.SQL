SELECT TO_CHAR(HPV.DHR_INCLU, 'YYYYMM') AS ANO_MES, TO_CHAR(HPV.DHR_INCLU, 'DD/MM/YYYY HH24:MI:SS') AS DHR_INCLU,
FC_VINCULADO_NOM_GUERR(HPV.CTL_REMET) AS ORIGEM, FC_VINCULADO_NOM_GUERR(HPV.CTL_TRNSP) AS TRANSP,
FC_VINCULADO_NOM_GUERR(HDPV.CTL_DESTI) AS DESTINO, TO_CHAR(HPV.DHR_PLVIA_INI, 'DD/MM/YYYY HH24:MI:SS') AS DHR_PREV_SAIDA,
TO_CHAR(HPV.DHR_PLVIA_TER, 'DD/MM/YYYY HH24:MI:SS') AS DHR_PREV_CHEGADA,
NVL(TO_CHAR(FC_H_DHR_INICIO_VIAGEM(HPV.CTL_PLVIA), 'DD/MM/YYYY HH24:MI:SS'),' ') AS DHR_SAIDA_REA,
NVL(TO_CHAR(FC_H_DHR_FIM_VIAGEM_N(HPV.CTL_PLVIA, HDPV.CTL_DESTI), 'DD/MM/YYYY HH24:MI:SS'),' ') AS DHR_CHEGADA_REA,
DECODE(HPV.TIP_RASTR,1,'SATELITE',2,'CARTAO',3,'TELEFONICO') AS TIP_RASTR, FC_VINCULADO_NOM_GUERR(HPV.CTL_MOTOT) AS MOTORISTA,
NVL(FC_H_PLACA_VEICULO(HPV.CTL_PLVIA), ' ') AS PLACA_VEICULO,
NVL(FC_H_PLACA_CARRETA(HPV.CTL_PLVIA), ' ') AS PLACA_CARRETA,
FC_H_QTD_PRV(HPV.CTL_PLVIA) AS QTD_H_PARAD_PRV, FC_H_QTD_REA(HPV.CTL_PLVIA) AS QTD_PARAD_REAL, FC_H_QTD_EXTRA(HPV.CTL_PLVIA) AS QTD_PARAD_EXT,
DECODE(HPV.TIP_MOTOT,1,'FROTA',2,'AGREGADO',3,'AUTONOMO',' ') AS TIPO_MOTORISTA, SPV.DES_SITUA AS SITUACAO_PV
FROM HIST_PLANO_VIAGEM HPV, HIST_DESTINATARIO_PLANO_VIAGEM HDPV, SITUACAO_PLANO_VIAGEM SPV
WHERE HPV.SIT_PLVIA <> 10
AND HPV.CTL_OPERA_TIP = 3
AND TO_CHAR(HPV.DHR_INCLU, 'YYYYMMDD') between '20030501' and '20030531'
AND HPV.CTL_PLVIA = HDPV.CTL_PLVIA(+)
AND HPV.SIT_PLVIA = SPV.SIT_PLVIA(+)
ORDER BY ANO_MES, DHR_INCLU



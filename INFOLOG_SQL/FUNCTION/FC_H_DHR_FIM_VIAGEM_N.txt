CREATE OR REPLACE
FUNCTION FC_H_DHR_FIM_VIAGEM_N (PCTL_VIA NUMBER, PCTL_DES NUMBER)
RETURN DATE
AS
CURSOR
 FV IS
 SELECT dhr_efeti_rea AS dhr_viage_ter
   FROM SUPERVISOR.HIST_ROTEIRO_MOTORISTA
  WHERE sit_fase_rea IN ( 'R', 'T' )
    AND ctl_parad = 12
    AND ctl_plvia = PCTL_VIA
    AND ctl_ptopd = PCTL_DES;
 FVR FV%ROWTYPE;
BEGIN
 OPEN FV;
 FETCH FV INTO FVR;
 IF FV%NOTFOUND THEN
    RETURN(NULL);
 END IF;
 CLOSE FV;
 RETURN(FVR.dhr_viage_ter);
END;
/

CREATE OR REPLACE
FUNCTION SUPERVISOR.FC_CONV_COORDENADA_DEC_GEO
(COORDENADA NUMBER, TIPO NUMBER)
RETURN
VARCHAR2
AS
RETORNO VARCHAR2(100);
GRAU 	NUMBER :=0;
MN 	NUMBER :=0;
MINRST  NUMBER :=0;
SEG 	NUMBER :=0;
SINAL   NUMBER :=0;
RST     NUMBER :=0;
BEGIN
 IF COORDENADA=0 THEN
    RETURN 0;
 END IF;
 IF TIPO = 1 THEN
	 IF INSTR(COORDENADA,',') > 0 THEN
	     IF LENGTH(COORDENADA) < 6 THEN
		RETORNO := RTRIM(LTRIM(TO_CHAR(COORDENADA,'000000')));
	     END IF;
	     GRAU:= TO_NUMBER(SUBSTR(COORDENADA, 1, INSTR(COORDENADA,',')-1));
	     MINRST:= TO_NUMBER(SUBSTR(COORDENADA, INSTR(COORDENADA,',') + 1 ,LENGTH(COORDENADA)) * 60);
	     MN := TO_NUMBER(SUBSTR(MINRST,1,2));
	     SEG := TO_NUMBER(SUBSTR(SUBSTR(MINRST,3) * 60,1,2));
	     RETORNO := FC_FORMATA_COORDENADA_GEO(GRAU,MN,SEG);
	 ELSE
	     SINAL:= 0;
	     IF LENGTH(COORDENADA) < 6 THEN
	 	RETORNO := RTRIM(LTRIM(TO_CHAR(COORDENADA,'000000')));
	     END IF;
	     IF INSTR(COORDENADA,'-') > 0 THEN
	     	SINAL:=1;
	     END IF;
	     GRAU:= TO_NUMBER(SUBSTR(COORDENADA, SINAL + 1, 2));
	     MN := TO_NUMBER(SUBSTR(COORDENADA,SINAL + 3,2));
	     SEG := TO_NUMBER(SUBSTR(COORDENADA, SINAL + 5,2));
     	     RETORNO := FC_FORMATA_COORDENADA_GEO(GRAU,MN,SEG);
	 END IF;
 ELSIF TIPO = 2 THEN
 	SINAL:=0;
 	IF INSTR(COORDENADA,',',1) = 0 THEN
	    IF LENGTH(COORDENADA) < 6 THEN
	       RETORNO := RTRIM(LTRIM(TO_CHAR(COORDENADA,'000000')));
	    END IF;
	    IF INSTR(COORDENADA,'-') > 0 THEN
     		SINAL:=1;
	    END IF;
	    GRAU := TO_NUMBER(SUBSTR(COORDENADA, SINAL + 1, 2));
	    MN := TO_NUMBER(SUBSTR(COORDENADA, SINAL + 3, 2));
	    SEG := TO_NUMBER(SUBSTR(COORDENADA, SINAL + 5, 2));
	    RST := ROUND(GRAU + (MN/60) + (SEG/3600),12);
	    RETORNO := RST;
    	ELSE
    	    RETORNO := COORDENADA;
	END IF;
 END IF;
 RETURN RETORNO;
END;
/

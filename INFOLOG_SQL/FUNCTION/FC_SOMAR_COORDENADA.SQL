create or replace FUNCTION FC_SOMAR_COORDENADA
(COORDENADA VARCHAR2, TIPO NUMBER)
RETURN
VARCHAR2 AS
RETORNO VARCHAR2(6);
V_COORDENADA VARCHAR2(6);
G_COORD NUMBER:=0;
M_COORD NUMBER:=0;
S_COORD NUMBER:=0;
BEGIN
	V_COORDENADA  := COORDENADA;
	IF INSTR(V_COORDENADA,'-') > 0 THEN
		V_COORDENADA := SUBSTR(V_COORDENADA,2,LENGTH(V_COORDENADA));
	END IF;
	G_COORD := SUBSTR(V_COORDENADA,1,2);
	M_COORD := SUBSTR(V_COORDENADA,3,2);
	S_COORD := SUBSTR(V_COORDENADA,(LENGTH(V_COORDENADA)-1),2) + TIPO;
	IF(S_COORD<0)THEN
		S_COORD := 60 - ABS(S_COORD);
		M_COORD := SUBSTR(V_COORDENADA,(LENGTH(V_COORDENADA)-3),2) - 1;
		IF(M_COORD<0) THEN
			M_COORD := 60 - ABS(M_COORD);
			G_COORD := SUBSTR(V_COORDENADA,(LENGTH(V_COORDENADA)-6),2) - 1;
		END IF;
	END IF;
	IF(S_COORD>59)THEN
		S_COORD := ABS(SUBSTR(V_COORDENADA,(LENGTH(V_COORDENADA)-1),2)-60);
		M_COORD := ABS(SUBSTR(V_COORDENADA,(LENGTH(V_COORDENADA)-3),2) + 1);
		IF(M_COORD>59) THEN
			M_COORD := ABS(SUBSTR(V_COORDENADA,(LENGTH(V_COORDENADA)-3),2)-60);
			G_COORD := ABS(SUBSTR(V_COORDENADA,(LENGTH(V_COORDENADA)-6),2) + 1);
		END IF;
	END IF;
	RETORNO	:= FC_FORMATA_COORDENADA_GEO(G_COORD,M_COORD,S_COORD);
	RETURN RETORNO;
END;
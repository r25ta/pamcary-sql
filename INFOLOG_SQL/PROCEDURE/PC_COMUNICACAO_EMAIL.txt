CREATE OR REPLACE
PROCEDURE PC_EMAIL_SOLICITACAO_ENDERECO ( 
             PCTL_REMET NUMBER, PCTL_DESTI NUMBER, PSTA_ENVIO NUMBER, PCTL_SOLIC_ENV NUMBER )
AS
CURSOR
 TEMAIL IS
 SELECT LOWER(NVL(des_comun, ' ' )) AS des_comun
   FROM SUPERVISOR.COMUNICACAO_CONTATO CC, 
        SUPERVISOR.DADO_ADICIONAL_EMBARC_CLIENTE DAEC
  WHERE DAEC.ctl_remet = PCTL_REMET AND DAEC.ctl_desti = PCTL_DESTI
    AND DAEC.sta_envio >= PSTA_ENVIO
    AND DAEC.ctl_desti = CC.ctl_vincd
    AND CC.ctl_vincd = PCTL_DESTI
    AND CC.tip_comun = 7;
 
  REMAIL TEMAIL%ROWTYPE;
BEGIN
 OPEN TEMAIL;
 FETCH TEMAIL INTO REMAIL;
 
 WHILE TEMAIL%FOUND LOOP
   
   IF REMAIL.des_comun != ' ' THEN
      INSERT INTO SUPERVISOR.EMAIL_SOLICITACAO_ENDERECO 
       VALUES ( SUPERVISOR.SQ_CTL_SOLIC_END.nextval, 'REMAIL.des_comun', PCTL_SOLIC_ENV );
   END IF;
 
 END LOOP;
 CLOSE TEMAIL;

END;
/

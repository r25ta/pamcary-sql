--SATELITE MENSAGEM
SELECT     PV.CTL_PLVIA, PV.TIP_RASTR, TR.DES_TIPO_RST, PV.CTL_EMPRE_EQU, PV.STA_CIRCU_ETC, PV.STA_COLET, PV.STA_ENTRE_DIT, PV.STA_ENTRE, PV.STA_TRANF,    
                      LMT.NUM_TERMN, LMT.NUM_SEQUE_TER, LMT.NUM_LATIT, LMT.NUM_LONGI,
                      LMT.DHR_EVENT, LMT.DES_EVENT, LMT.TIP_EVENT_TER, LMTD.TXT_EVENT_TER,     
                      NVL(FC_PLACA_VEICULO(PV.CTL_PLVIA), '0000000') AS PLACA_DO_VEICULO,  
  				      NVL(FC_ID_TRANSPONDER(PV.CTL_PLVIA), '0') AS ID_TRANSPONDER,    
                      NVL(PV.NUM_PCARD,' ') AS NUM_PCARD,
                      NVL(FC_PLACA_CARRETA(PV.CTL_PLVIA), '0000000') AS PLACA_CARRETA,  
  				      NVL(FC_ID_VEICULO(PV.CTL_PLVIA), '0') AS ID_TERMINAL_VEICULO                       
                      
FROM         PLANO_VIAGEM PV INNER JOIN   
                      TIPO_RASTREAMENTO TR ON PV.TIP_RASTR = TR.TIP_RASTR INNER JOIN   
                      PROVEDOR_TECNOLOGIA PROVTEC ON PV.CTL_EMPRE_EQU = PROVTEC.CTL_PROVE_TEC INNER JOIN   
                      LOG_MONITORA_TERMINAL LMT ON PV.CTL_PLVIA = LMT.CTL_PLVIA INNER JOIN   
                      LOG_MONITORA_TERMINAL_DET LMTD ON LMT.NUM_TERMN = LMTD.NUM_TERMN AND    
                      LMT.NUM_SEQUE_TER = LMTD.NUM_SEQUE_TER INNER JOIN   
                      TIPO_EVENTO_TERMINAL TET ON LMT.TIP_EVENT_TER = TET.TIP_EVENT_TER INNER JOIN   
                      TIPO_OPERACAO TPO ON PV.CTL_OPERA_TIP = TPO.CTL_OPERA_TIP
 WHERE      
 (LMT.TIP_EVENT_TER <> 99)  
 AND (LMT.SIT_PROCE_INT = 'R') 
 AND (PV.CTL_OPERA_TIP = 27)     
 
 
 
 
 -- POSICAO SATELITE
SELECT     PV.CTL_PLVIA, PV.TIP_RASTR, TR.DES_TIPO_RST, PV.CTL_EMPRE_EQU, PV.STA_CIRCU_ETC, PV.STA_COLET, PV.STA_ENTRE_DIT, PV.STA_ENTRE, PV.STA_TRANF,    
                      LMT.NUM_TERMN, LMT.NUM_LATIT, LMT.NUM_LONGI, 
                      LMT.DHR_EVENT, LMT.DES_EVENT, LMT.TIP_EVENT_TER, LMT.TXT_EVENT_TER,     
                      NVL(FC_PLACA_VEICULO(PV.CTL_PLVIA), '0000000') AS PLACA_DO_VEICULO,  
  				      NVL(FC_ID_TRANSPONDER(PV.CTL_PLVIA), '0') AS ID_TRANSPONDER,    
                      NVL(PV.NUM_PCARD,' ') AS NUM_PCARD,
                      NVL(FC_PLACA_CARRETA(PV.CTL_PLVIA), '0000000') AS PLACA_CARRETA,  
  				      NVL(FC_ID_VEICULO(PV.CTL_PLVIA), '0') AS ID_TERMINAL_VEICULO                       
                      
FROM         PLANO_VIAGEM PV INNER JOIN   
                      TIPO_RASTREAMENTO TR ON PV.TIP_RASTR = TR.TIP_RASTR INNER JOIN   
                      PROVEDOR_TECNOLOGIA PROVTEC ON PV.CTL_EMPRE_EQU = PROVTEC.CTL_PROVE_TEC INNER JOIN   
                      MONITORA_TERMINAL LMT ON PV.CTL_PLVIA = LMT.CTL_PLVIA INNER JOIN   
                      TIPO_EVENTO_TERMINAL TET ON LMT.TIP_EVENT_TER = TET.TIP_EVENT_TER INNER JOIN   
                      TIPO_OPERACAO TPO ON PV.CTL_OPERA_TIP = TPO.CTL_OPERA_TIP
 WHERE      
 (LMT.TIP_EVENT_TER = 99)  
 AND (LMT.SIT_PROCE_INT = 'R') 
 AND (PV.CTL_OPERA_TIP = 27)     

 
--CARTAO 
 SELECT     PV.CTL_PLVIA, PV.TIP_RASTR, TR.DES_TIPO_RST, PV.STA_CIRCU_ETC, PV.STA_COLET, PV.STA_ENTRE_DIT,
                      PV.STA_ENTRE, PV.STA_TRANF,    
                      LMT.DHR_PASSA_CAO, LMT.COD_DOCUM, LMT.NUM_FUNCA_COL,
                      NVL(FC_PLACA_VEICULO(PV.CTL_PLVIA), '0000000') AS PLACA_DO_VEICULO,  
  				      NVL(FC_ID_TRANSPONDER(PV.CTL_PLVIA), '0') AS ID_TRANSPONDER,    
                      NVL(PV.NUM_PCARD,' ') AS NUM_PCARD,
                      NVL(FC_PLACA_CARRETA(PV.CTL_PLVIA), '0000000') AS PLACA_CARRETA,  
  				      NVL(FC_ID_VEICULO(PV.CTL_PLVIA), '0') AS ID_TERMINAL_VEICULO
 
FROM PLANO_VIAGEM PV INNER JOIN   
                      TIPO_RASTREAMENTO TR ON PV.TIP_RASTR = TR.TIP_RASTR INNER JOIN   
                      MONITORA_CARTAO_DETALHE LMT ON PV.CTL_PLVIA = LMT.CTL_PLVIA INNER JOIN   
                      TIPO_EVENTO_TERMINAL TET ON LMT.NUM_FUNCA_COL = TET.TIP_EVENT_TER INNER JOIN   
                      TIPO_OPERACAO TPO ON PV.CTL_OPERA_TIP = TPO.CTL_OPERA_TIP
WHERE  
LMT. STA_PROCS = 'P'
AND LMT.SIT_PROCE_INT ='R'
AND PV.CTL_OPERA_TIP = 27




--TRANSPONDER
 SELECT     PV.CTL_PLVIA, PV.TIP_RASTR, TR.DES_TIPO_RST, PV.STA_CIRCU_ETC, PV.STA_COLET, PV.STA_ENTRE_DIT,
                      PV.STA_ENTRE, PV.STA_TRANF,    
                      DHR_EVENT, LMT.CTL_RTMOT, LMT.CTL_PARAD,
                      NVL(FC_PLACA_VEICULO(PV.CTL_PLVIA), '0000000') AS PLACA_DO_VEICULO,  
  				      NVL(FC_ID_TRANSPONDER(PV.CTL_PLVIA), '0') AS ID_TRANSPONDER,    
                      NVL(PV.NUM_PCARD,' ') AS NUM_PCARD,
                      NVL(FC_PLACA_CARRETA(PV.CTL_PLVIA), '0000000') AS PLACA_CARRETA,  
  				      NVL(FC_ID_VEICULO(PV.CTL_PLVIA), '0') AS ID_TERMINAL_VEICULO,
                      RM.CTL_PLVIA  
FROM PLANO_VIAGEM PV INNER JOIN   
                      ROTEIRO_MOTORISTA RM ON RM.ctl_PLVIA = pv.ctl_PLVIA INNER JOIN
                      POSICAO_DISPOSITIVO LMT ON RM.cTL_rTmot = LMT.cTL_rTmot INNER JOIN                         
                      TIPO_RASTREAMENTO TR ON PV.TIP_RASTR = TR.TIP_RASTR INNER JOIN                         
                      TIPO_EVENTO_TERMINAL TET ON LMT.CTL_PARAD = TET.TIP_EVENT_TER INNER JOIN   
                      TIPO_OPERACAO TPO ON PV.CTL_OPERA_TIP = TPO.CTL_OPERA_TIP
WHERE  
LMT.TIP_RASTR_COL = 3
AND LMT. STA_PROCS = 'S'
AND LMT.SIT_PROCE_INT ='R'
AND PV.CTL_OPERA_TIP = 27
